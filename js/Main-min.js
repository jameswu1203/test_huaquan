function criate_sin_table(){sin_t=new Array(360);for(var i=0;i<360;i++){sin_t[i]=Math.sin((i/180)*Math.PI)}}function criate_cos_table(){cos_t=new Array(360);for(var i=0;i<360;i++){cos_t[i]=Math.cos((i/180)*Math.PI)}}function get_sin(th){var ret=(th*180)/Math.PI;ret=Math.round(ret)%360;if(ret<0){ret*=-1;return -sin_t[ret]}else{return sin_t[ret]}}function get_cos(th){var ret=(th*180)/Math.PI;ret=Math.round(ret)%360;if(ret<0){ret*=-1;return cos_t[ret]}else{return cos_t[ret]}}var Texture=function(){this.x=0;this.y=0;this.width=80;this.height=64;this.srcx=0;this.srcy=0;this.exist=true;this.time=0;this.size=1;this.angle=0;this.cx=(this.width*this.size)/2;this.cy=(this.height*this.size)/2;this.alpha=1};Texture.prototype.draw=function(){context.save();context.translate(this.x,this.y);context.rotate(this.angle);context.translate(-this.cx,-this.cy);context.globalAlpha=this.alpha;context.drawImage(picture,this.srcx,this.srcy,this.width,this.height,0,0,this.width*this.size,this.height*this.size);context.restore()};Texture.prototype.setTex=function(srcx,srcy,width,height){this.width=width;this.height=height;this.srcx=srcx;this.srcy=srcy};var Kingyo=function(){this.head=new Texture();this.body=new Texture();this.body2=new Texture();this.tail=new Texture();if(Math.random()<0.7){this.head.setTex(161,1,76,60);this.body.setTex(240,0,32,32);this.body2.setTex(240,32,32,32);this.tail.setTex(272,0,32,32)}else{this.head.setTex(1,1,76,60);this.body.setTex(80,0,32,32);this.body2.setTex(80,32,32,32);this.tail.setTex(112,0,32,32)}this.movestat=0;this.x=0;this.y=0;this.angle=0;this.vx=0;this.vy=0;this.speed=2;this.speed_rate=1;this.escape_time=0;this.round_angle=0;this.random_time=0;this.sight_length=96*1.3;this.sight_x=0;this.sight_y=0;this.collision_size=25;this.tail_cnt=0;this.cap_x=0;this.cap_y=0};Kingyo.prototype.move=function(){if(this.movestat==MOVE_CAPTURED){if(mouse_status.tap_flag==false){this.movestat=MOVE_NOMAL}this.x=poi.x+this.cap_x;this.y=poi.y+this.cap_y;this.angle+=this.round_angle;this.x=Math.round(this.x);this.y=Math.round(this.y);this.vx=get_cos(this.angle);this.vy=get_sin(this.angle);this.head.x=this.x;this.head.y=this.y;this.head.angle=this.angle+(5*Math.PI/180)*get_cos(this.tail_cnt*3);this.body.x=this.x-16*this.head.size*this.vx;this.body.y=this.y-16*this.head.size*this.vy;this.body.angle=this.head.angle;this.body2.x=this.body.x-25*this.head.size*get_cos(this.body.angle);this.body2.y=this.body.y-25*this.head.size*get_sin(this.body.angle);this.body2.angle=this.head.angle;this.tail.x=this.body2.x-15*this.head.size*get_cos(this.body.angle);this.tail.y=this.body2.y-15*this.head.size*get_sin(this.body.angle);this.tail.angle=this.head.angle;this.sight_x=this.x+this.vx*this.sight_length;this.sight_y=this.y+this.vy*this.sight_length}else{if(this.escape_time<=5){this.speed_rate-=0.2}if(this.escape_time<0){this.speed_rate=1}this.body2.angle=this.body.angle;this.tail.angle=this.body2.angle;this.x+=this.speed*this.vx*this.speed_rate;this.y+=this.speed*this.vy*this.speed_rate;this.angle+=this.round_angle;this.x=Math.round(this.x);this.y=Math.round(this.y);this.vx=get_cos(this.angle);this.vy=get_sin(this.angle);this.head.x=this.x;this.head.y=this.y;this.head.angle=this.angle;this.body.x=this.x-16*this.head.size*this.vx;this.body.y=this.y-16*this.head.size*this.vy;this.body.angle=this.round_angle+this.angle+(10*Math.PI/180)*get_cos(this.tail_cnt*0.5);this.body2.x=this.body.x-25*this.head.size*get_cos(this.body.angle);this.body2.y=this.body.y-25*this.head.size*get_sin(this.body.angle);this.tail.x=this.body2.x-15*this.head.size*get_cos(this.body2.angle);this.tail.y=this.body2.y-15*this.head.size*get_sin(this.body2.angle);this.sight_x=this.x+this.vx*this.sight_length;this.sight_y=this.y+this.vy*this.sight_length;var cx=(this.head.width*this.head.size)/2;var cy=(this.head.height*this.head.size)/2;if(this.movestat!=MOVE_AVOIDWALL){if(this.random_time<0&&Math.random()<0.3){this.round_angle=0.05-0.1*Math.random();this.random_time=5+10*Math.random();this.speed=1.5+2*Math.random()}if(this.random_time<0){this.round_angle=0}}if(this.sight_x>GAME_WIDTH-cx||this.sight_x<0+cx||this.sight_y>GAME_HEIGHT-cy||this.sight_y<0+cy){if(this.movestat!=MOVE_AVOIDWALL){var wall_vx=0;var wall_vy=0;if(this.sight_x+100>GAME_WIDTH-cx){wall_vy=1}if(this.sight_x-100<0+cx){wall_vy=-1}if(this.sight_y+100>GAME_HEIGHT-cy){wall_vx=-1}if(this.sight_y-100<0+cy){wall_vx=1}var th=get_cos(this.angle)*wall_vx+get_sin(this.angle)*wall_vy;if(th>0){this.movestat=MOVE_AVOIDWALL;this.round_angle=0.13}else{if(th<0){this.movestat=MOVE_AVOIDWALL;this.round_angle=-0.13}else{this.movestat=MOVE_AVOIDWALL;if(Math.random()>0.5){this.round_angle=0.13}else{this.round_angle=-0.13}}}}}else{this.movestat=MOVE_NOMAL}}this.tail_cnt++;this.random_time-=1;this.escape_time-=1};Kingyo.prototype.draw=function(){this.head.draw();this.body.draw();this.body2.draw();this.tail.draw()};Create_kingyo=function(){for(var i=0;i<kingyo.length;i++){if(kingyo[i]==undefined||kingyo[i].exist==false){kingyo[i]=undefined;
kingyo[i]=new Kingyo();kingyo[i].x=GAME_WIDTH/2;kingyo[i].y=GAME_HEIGHT/2;kingyo[i].angle=2*Math.PI*Math.random();kingyo[i].vx=Math.cos(kingyo[i].angle);kingyo[i].vy=Math.sin(kingyo[i].angle);size=0.3+0.3*Math.random();kingyo[i].head.size=size;kingyo[i].body.size=size;kingyo[i].body2.size=size;kingyo[i].tail.size=size;kingyo[i].sight_length=size*96*1.5;kingyo[i].collision_size=size*20;kingyo[i].head.cx=(kingyo[i].head.width*size)/2;kingyo[i].head.cy=(kingyo[i].head.height*size)/2;kingyo[i].body.cx=(kingyo[i].body.width*size);kingyo[i].body.cy=(kingyo[i].body.height*size)/2;kingyo[i].body2.cx=(kingyo[i].body2.width*size);kingyo[i].body2.cy=(kingyo[i].body2.height*size)/2;kingyo[i].tail.cx=(kingyo[i].tail.width*size);kingyo[i].tail.cy=(kingyo[i].tail.height*size)/2;kingyo[i].tail_cnt=360*Math.random();kingyo[i].head.alpha=1;return kingyo[i]}}};var Poi=function(){this.x=0;this.y=0;this.old_x=0;this.old_y=0;this.speed=0;this.offset_x=-56;this.offset_y=-48;this.collision_size=0;this.visible=false;this.down_flag=false;this.dist=0;this.up_time=5;this.waku=new Texture();this.waku.setTex(32,64,96,96);this.waku.size=1;this.waku.x=0;this.waku.y=0;this.kami=new Texture();this.kami.setTex(0,64,64,64);this.kami.angle=2*Math.PI*Math.random();this.kami.cx=this.kami.width/2;this.kami.cy=this.kami.height/2;this.capture_num=0;this.durability=2000;this.inwater_time=0};Poi.prototype.move=function(){if(mouse_status.tap_flag==true){this.old_x=this.x;this.old_y=this.y;this.x=mouse_status.x;this.y=mouse_status.y;if(this.x<50){this.x=50}if(this.y<50){this.y=50}if(mouse_status.tapped_flag==true){this.dist=0;this.up_time=5;this.old_x=this.x;this.old_y=this.y;this.speed=0}this.speed=(this.x-this.old_x)*(this.x-this.old_x)+(this.y-this.old_y)*(this.y-this.old_y);if(this.down_flag==false&&this.capture_num==0){if(this.speed>15){this.dist+=this.speed;if(this.dist>900){this.down_flag=true;this.inwater_time=0}}else{this.dist=0;this.down_flag=false}}if(this.down_flag==true&&this.speed<3){this.down_flag=false;this.dist=0;this.up_time=0;this.inwater_time=0}this.waku.x=this.x-50;this.waku.y=this.y-50;if(this.down_flag==true){this.inwater_time+=1;this.up_time=0}else{this.up_time++}for(var i=0;i<kingyo.length;i++){if(kingyo[i]!=undefined&&this.down_flag==true&&kingyo[i].movestat!=MOVE_CAPTURED){if((this.x-this.collision_size+this.offset_x<kingyo[i].x+kingyo[i].collision_size)&&(this.x+this.collision_size+this.offset_x>kingyo[i].x-kingyo[i].collision_size)&&(this.y-this.collision_size+this.offset_y<kingyo[i].y+kingyo[i].collision_size)&&(this.y+this.collision_size+this.offset_y>kingyo[i].y-kingyo[i].collision_size)){kingyo[i].cap_x=-this.waku.x+kingyo[i].x+this.offset_x+4;kingyo[i].cap_y=-this.waku.y+kingyo[i].y+this.offset_y-2;kingyo[i].round_angle=0;kingyo[i].speed_rate=2.5;kingyo[i].escape_time=15+20*Math.random();kingyo[i].movestat=MOVE_CAPTURED;this.capture_num++}}}if(this.down_flag==true){if((this.x-this.collision_size+this.offset_x<sara.x+sara.collision_size)&&(this.x+this.collision_size+this.offset_x>sara.x-sara.collision_size)&&(this.y-this.collision_size+this.offset_y<sara.y+sara.collision_size)&&(this.y+this.collision_size+this.offset_y>sara.y-sara.collision_size)){this.down_flag=false;this.dist=0}}var damage=0;damage=0;if(this.down_flag==true){this.durability-=this.inwater_time}damage=0;if(this.capture_num!=0){for(var i=0;i<kingyo.length;i++){if(kingyo[i]!=undefined&&kingyo[i].movestat==MOVE_CAPTURED){damage+=(kingyo[i].head.size/0.6)*1.3}}this.durability-=damage}}if(mouse_status.tap_flag==false||game_status.gameover_time>0){if(this.capture_num>0&&this.down_flag==false){var temp_point=0;var temp_bairitsu=0;for(var i=0;i<kingyo.length;i++){if(kingyo[i]!=undefined&&kingyo[i].movestat==MOVE_CAPTURED){if((sara.x-sara.collision_size<kingyo[i].x+kingyo[i].collision_size)&&(sara.x+sara.collision_size>kingyo[i].x-kingyo[i].collision_size)&&(sara.y-sara.collision_size<kingyo[i].y+kingyo[i].collision_size)&&(sara.y+sara.collision_size>kingyo[i].y-kingyo[i].collision_size)){for(var j=0;j<5;j++){Create_particle()}temp_point+=Math.round(200+(kingyo[i].head.size/0.6)*200);temp_bairitsu+=1;game_status.captured_fish++;kingyo[i]=undefined;kingyo.splice(i,1);if(kingyo.length==0){game_status.gameover_flag=true}}else{kingyo[i].movestat=MOVE_NOMAL}}}}}if(this.durability<0){this.dist=0;this.down_flag=false;game_status.gameover_time++}if(game_status.gameover_time>25){game_status.gameover_flag=true}};Poi.prototype.draw=function(){if(mouse_status.tap_flag==true&&game_status.gameover_flag==false&&game_status.gamestart_flag==false){var temp_dist=this.dist;var temp_up_time=this.up_time;if(temp_dist<450){temp_dist=0}if(temp_dist>900){temp_dist=900}if(temp_up_time>5){temp_up_time=5}var color_depth=5+5*(1-(temp_dist/900));color_depth/=10;var color_depth2=0.5+(temp_up_time*0.1);if(color_depth2<color_depth){color_depth=color_depth2}context.save();context.strokeStyle="rgba( 255, 255, 0, "+color_depth+")";context.beginPath();context.arc(this.x+this.offset_x,this.y+this.offset_y,30,0,2*Math.PI,true);
context.closePath();context.lineWidth=2;context.stroke();context.restore();context.save();context.strokeStyle="rgba(255, 255, 0,"+color_depth+")";context.beginPath();context.moveTo(this.x+10,this.y+10);context.lineTo(this.x+this.offset_x+20,this.y+this.offset_y+20);context.closePath();context.lineWidth=4;context.lineCap="round";context.stroke();context.restore();var kami_color_depth=color_depth-0.2;this.kami.alpha=kami_color_depth;this.kami.x=this.x-56;this.kami.y=this.y-48;if(this.durability<0){this.kami.setTex(256,64,64,64)}else{if(this.durability<200){this.kami.setTex(192,64,64,64)}else{if(this.durability<600){this.kami.setTex(128,64,64,64)}else{if(this.durability<1200){this.kami.setTex(64,64,64,64)}else{this.kami.setTex(0,64,64,64)}}}}this.kami.draw()}};var Sara=function(){this.x=20;this.y=20;this.collision_size=55};Sara.prototype.move=function(){};Sara.prototype.draw=function(){context.save();context.drawImage(picture,0,192,112,112,-30,-30,112,112);context.restore()};var Status=function(){this.gameover_flag=false;this.gameover_time=0;this.gamestart_flag=true;this.gamestart_time=0;this.x=GAME_WIDTH+32+12;this.y=10;this.point=0;this.point_visual=0;this.frame_point=0;this.point_size=1;this.left_poi=4;this.left_time_max=20*30;this.left_time=this.left_time_max;this.captured_fish=0;this.captured_fish_x=GAME_WIDTH+32+12;this.captured_fish_y=180;this.combo_alpha=1;this.combo_size=1;this.combo_point=0;this.combo_point_x=120;this.combo_point_y=20;this.combo_num=0;this.combo_anime_time=0;this.combo_x=100;this.combo_y=20};Status.prototype.move=function(){this.combo_anime_time--;if(this.combo_anime_time<0){this.combo_anime_time=0}var tempsize=1;if(this.combo_anime_time<40){tempsize=0}else{tempsize=this.combo_anime_time-40}this.combo_size=1+tempsize;if(this.combo_anime_time<43&&this.combo_anime_time>=33){this.point_visual+=this.frame_point;if(this.combo_anime_time==33){this.point_visual=this.point}}if(this.combo_anime_time<43&&this.combo_anime_time>=40){this.point_size+=0.2;if(this.combo_anime_time==40){this.point_size=1.6}}if(this.combo_anime_time<33&&this.combo_anime_time>=30){this.point_size-=0.2;if(this.combo_anime_time==28){this.point_size=1}}};Status.prototype.draw=function(){if(this.combo_anime_time>0){context.save();context.globalAlpha=0.3;context.fillStyle="rgb(100,255,100)";context.fillRect(100,20,165*this.combo_size,20*this.combo_size);context.restore()}context.save();context.drawImage(picture,32,160,48,32,this.x-38,this.y,30,22);context.restore();var temp_point=this.point_visual;var top_zero_flag=true;for(var i=6;i>=0;i--){var num=Math.floor(temp_point/Math.pow(10,i));if(num!=0&&top_zero_flag==true){top_zero_flag=false}if(top_zero_flag==false||num!=0||i==0){context.save();context.drawImage(picture,32*num,128,32,32,this.x-35+11-((22*this.point_size)/2),this.y+10+16*(6-i)+11-((22*this.point_size)/2),22*this.point_size,22*this.point_size);context.restore()}temp_point-=num*Math.pow(10,i)}context.save();context.drawImage(picture,0,160,32,32,this.x-35,this.y+16+16*7,22,22);context.restore();context.save();context.drawImage(picture,208,160,48,32,this.captured_fish_x-38,this.captured_fish_y,30,22);context.restore();var temp_point=this.captured_fish;var top_zero_flag=true;for(var i=3;i>=0;i--){var num=Math.floor(temp_point/Math.pow(10,i));if(num!=0&&top_zero_flag==true){top_zero_flag=false}if(top_zero_flag==false||num!=0||i==0){context.save();context.drawImage(picture,32*num,128,32,32,this.captured_fish_x-35+11-((22*this.point_size)/2),this.captured_fish_y+10+16*(3-i)+11-((22*this.point_size)/2),22*this.point_size,22*this.point_size);context.restore()}temp_point-=num*Math.pow(10,i)}context.save();context.drawImage(picture,256,160,32,32,this.captured_fish_x-35,this.captured_fish_y+16+16*4,22,22);context.restore();if(this.combo_anime_time>0){if(this.combo_point>0){var temp_point=this.combo_point;var top_zero_flag=true;for(var i=5;i>=0;i--){var num=Math.floor(temp_point/Math.pow(10,i));if(num!=0&&top_zero_flag==true){top_zero_flag=false}if(top_zero_flag==false||num!=0||i==0){context.save();context.drawImage(picture,32*num,128,32,32,this.combo_point_x+10+18*(5-i),this.combo_point_y,22*this.combo_size,22*this.combo_size);context.restore()}temp_point-=num*Math.pow(10,i)}context.save();context.drawImage(picture,0,160,32,32,this.combo_point_x+10+18*(5-i),this.combo_point_y,22*this.combo_size,22*this.combo_size);context.restore()}var temp_combo=this.combo_num;if(temp_combo>1){if(temp_combo<10){context.save();context.drawImage(picture,32*temp_combo,128,32,32,this.combo_x,this.combo_y-3,25*this.combo_size,25*this.combo_size);context.restore()}else{if(temp_combo==10){context.save();context.drawImage(picture,176,160,32,32,this.combo_x,this.combo_y-3,25*this.combo_size,25*this.combo_size);context.restore()}}context.save();context.drawImage(picture,128,160,48,32,this.combo_x+26,this.combo_y,30*this.combo_size,22*this.combo_size);context.restore()}}};var Mouse_status=function(){this.x=0;this.y=0;this.click_x=0;this.click_y=0;this.drag_flag=false;
this.tap_flag=false;this.tapped_flag=false};var Particle=function(){this.x=poi.x-50;this.y=poi.y-50;this.speed=6+10*Math.random();this.angle=Math.floor(360*Math.random());this.alpha=0.7;this.exist=true;this.scale=0.5+0.5*Math.random();this.r=200;this.g=200;this.b=255;this.time=0};Particle.prototype.move=function(){this.scale-=0.06;this.x+=get_cos(this.angle)*this.speed;this.y+=get_sin(this.angle)*this.speed;if(this.scale<0.1){this.exist=false}this.time++};Particle.prototype.draw=function(){context.save();context.beginPath();context.fillStyle="rgb("+this.r+","+this.g+","+this.b+")";context.globalAlpha=this.alpha;context.arc(this.x,this.y,20*this.scale,0,2*Math.PI,false);context.fill();context.restore();context.globalAlpha=1};Create_particle=function(){for(var i=0;i<particle.length;i++){if(particle[i]==undefined||particle[i].exist==false){particle[i]=undefined;particle[i]=new Particle();return particle[i]}}};function gameover_move(){game_status.gameover_time++;if(mouse_status.tap_flag==true&&mouse_status.tapped_flag==true){game_status.gameover_flag=true;mouse_status.tap_flag=false;mouse_status.tapped_flag=false}}function gameover_draw(){window.location.href="garden.html";return false}function gameover_draw_orig(){var back_brack_alpha=(game_status.gameover_time-25)/20;if(back_brack_alpha>0.5){back_brack_alpha=0.5}context.save();context.fillStyle="rgba(0,0,0,"+back_brack_alpha+")";context.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT);context.restore();context.save();context.fillStyle="rgba(144,144,144,"+(back_brack_alpha+0.2)+")";context.fillRect(30,30,SCREEN_WIDTH-60,SCREEN_HEIGHT-60);context.restore();context.save();context.strokeStyle="rgba(165,165,0,"+(back_brack_alpha+0.5)+")";context.lineWidth=3;context.beginPath();context.strokeRect(30,30,SCREEN_WIDTH-60,SCREEN_HEIGHT-60);context.closePath();context.stroke();context.restore();context.save();context.font="23px 'MS Gothic'";context.fillStyle="rgba(220,220,100,"+(back_brack_alpha+0.5)+")";context.strokeStyle="rgba(165,165,0,"+(back_brack_alpha+0.5)+")";context.fillText("結果",130,70);context.strokeText("結果",130,70);context.fillText("点数",50,110);context.strokeText("点数",50,110);context.fillText(game_status.point+"点",50,140);context.strokeText(game_status.point+"点",50,140);context.fillText("捕まえた金魚",50,180);context.strokeText("捕まえた金魚",50,180);context.fillText(game_status.captured_fish+"匹",50,210);context.strokeText(game_status.captured_fish+"匹",50,210);context.restore();context.save();context.font="20px 'MS Gothic'";if(touchdev==true){context.fillText("画面にタッチ！",100,250)}else{context.fillText("画面をクリック！",90,250)}context.restore()}function gamestart_move(){game_status.gamestart_time++;if(mouse_status.tap_flag==true&&mouse_status.tapped_flag==true){game_status.gamestart_flag=false;mouse_status.tap_flag=false;mouse_status.tapped_flag=false}}function gamestart_draw(){context.save();context.fillStyle="rgba(0,0,0,0.5)";context.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT);context.restore();context.save();context.font="25px 'MS Gothic'";context.fillStyle="rgba(220,220,100,1.0)";context.strokeStyle="rgba(165,165,0,1.0)";context.save();context.drawImage(picture,128,192,176,112,60,60,176,112);context.restore();context.font="20px 'MS Gothic'";if(touchdev==true){context.fillText("画面にタッチでスタート！",40,250)}else{context.fillText("画面をクリックでスタート！",30,250)}}var SCENE_GAME=1;var SCENE_GAMEOVER=2;var scene=SCENE_GAME;var context;var picture=new Image();var mouse_status=new Mouse_status();var time=0;var MOVE_NOMAL=0;var MOVE_AVOIDWALL=1;var MOVE_AVOIDFISH=2;var MOVE_CAPTURED=3;var GAME_WIDTH=320;var GAME_HEIGHT=320;var SCREEN_WIDTH=320;var SCREEN_HEIGHT=320;var timerID;function game_init(){console.log(GAME_HEIGHT);kingyo=new Array(1);for(var i=0;i<kingyo.length;i++){Create_kingyo()}poi=new Poi();sara=new Sara();game_status=new Status();particle=new Array(50);for(var i=0;i<particle.length;i++){particle[i]=undefined}for(var j=0;j<100;j++){for(var i=0;i<kingyo.length;i++){kingyo[i].move()}}}function gameloop(){switch(scene){case SCENE_GAME:game_run();break}}function game_run(){context.save();context.fillStyle="#287BE6";context.fillRect(0,0,GAME_WIDTH,GAME_HEIGHT);context.restore();if(game_status.gameover_flag==false&&game_status.gamestart_flag==false){poi.move()}for(var i=0;i<kingyo.length;i++){kingyo[i].move()}sara.move();game_status.move();if(poi.down_flag==true){poi.draw()}for(var i=0;i<kingyo.length;i++){if(kingyo[i].movestat!=MOVE_CAPTURED){kingyo[i].draw()}}sara.draw();if(poi.down_flag==false){poi.draw()}for(var i=0;i<kingyo.length;i++){if(kingyo[i].movestat==MOVE_CAPTURED){kingyo[i].draw()}}for(var i=0;i<particle.length;i++){if(particle[i]!=undefined&&particle[i].exist==true){particle[i].move();particle[i].draw()}}game_status.draw();if(game_status.gameover_flag==true){console.log("start redirect");clearInterval(timerID);location.href="garden.html";return false;console.log("end redirect")}if(game_status.gamestart_flag==true){gamestart_move()}time++}function init(){canvas=document.getElementById("id_canvas");
if(!canvas||!canvas.getContext){alert("本ページの閲覧はHTML5対応ブラウザで行ってください");return false}context=canvas.getContext("2d");criate_sin_table();criate_cos_table();game_init();picture.src="kingyo.png?"+new Date().getTime();picture.onload=function(){timerID=setInterval("gameloop()",50)};var lasttouchx,lasttouchy;touchdev=false;if(navigator.userAgent.indexOf("iPhone")>0||navigator.userAgent.indexOf("iPod")>0||navigator.userAgent.indexOf("iPad")>0||navigator.userAgent.indexOf("Android")>0){touchdev=true}if(touchdev==false){canvas.addEventListener("mousemove",mousemovefunc,true);canvas.addEventListener("mousedown",mousedownfunc,true);canvas.addEventListener("mouseup",mouseupfunc,true)}else{canvas.addEventListener("touchstart",touchstart,true);canvas.addEventListener("touchmove",touchmove,true);canvas.addEventListener("touchend",touchend,true)}function touchstart(event){var x=event.touches[0].pageX;var y=event.touches[0].pageY;mouse_status.click_x=x;mouse_status.click_y=y;mouse_status.x=x;mouse_status.y=y;mouse_status.tap_flag=true;mouse_status.tapped_flag=true}function touchmove(event){var x=event.touches[0].pageX;var y=event.touches[0].pageY;mouse_status.x=x;mouse_status.y=y;mouse_status.tapped_flag=false}function touchend(event){mouse_status.tapped_flag=false;mouse_status.tap_flag=false}function mousemovefunc(event){mouse_status.x=event.clientX;mouse_status.y=event.clientY;mouse_status.tapped_flag=false}function mousedownfunc(event){mouse_status.x=event.clientX;mouse_status.y=event.clientY;mouse_status.tap_flag=true;mouse_status.tapped_flag=true}function mouseupfunc(event){mouse_status.tap_flag=false;mouse_status.tapped_flag=false}};